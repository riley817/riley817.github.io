# [TIL & Issue Note] 20230211


## 전통적인 게임의 서버 구조
### P2P
- 서버에 참여하는 구성원들이 서버이자 클라이언트의 역할을 한다.
- 주로 격투게임, 소규모 FPS 게임 등 반응 속도가 빨라야하는 장르에서 많이 사용했다.
- 인원수에 따라 유지해야 하는 연결의 개수가 많아 진다.

### Host 방식
- 게임에 참가하는 참가자 중 제일 처음 방을 만드는 참가자의 클라이언트를 서버로 사용
- 나머지 참가자는 클라이언트로서의 역할을 한다.
- 게임의 검증, 결과 판정 등은 호스트 클라이언트가 담당한다.
- 호스트에게 모든 데이터가 집중되므로 호스트의 컴퓨터 성능이 좋아야 한다.
- 호스트의 서버가 연결을 종료할 경우 접속한 모든 클라이언트가 게임을 할 수 없다.

### Host Migration
- Host 방식에서 좀 더 발전된 방식
- 호스트가 네트워킹을 종료할 경우 호스트 역할을 다른 클라이언트에게 위임한다.

### 전통적인 게임 서버 구조의 단점
- 네트워크에 참가한 클라이언트가 게임의 결과를 판정하므로 검증이 제대로 되지 않을 경우 데이터 변조가 가능하다.
- 보안상의 헛점에 취약하다. (ex 게임 핵 등)

## 현재의 게임 서버 구조

### 데디케이트 서버
- 서버와 클라이언트를 완전히 분리한다.
- 게임의 결과 판정과 데이터 검증은 서버에서만 이루어 진다.
- 보안성이 높다
- 대부분의 대규모 게임의 경우 데디케이트 서버 방식을 사용한다.
- 서버를 구성하고 유지하는 비용이 높다.

## 데이터 동기화 수준
게임의 데이터 동기화 수준은 장르에 따라 다르다.

- FPS, 레이싱 등 : 캐릭터 및 차량의 이동속도나 좌표 등이 수시로 업데이트되므로 데이터량이 많다.
- 턴제 전략게임, 카드게임(ex 하스스톤) 등 : 유저가 본인 턴에만 통신하므로 전송량이 작다.
- RTS `Real-Time Strategy` : 실시간 전략게임의 경우 움직이는 캐릭터 수가 많다.

### LockStep 전략
- 캐릭터의 상태값을 동기화 하지 않고 유저의 입력값(커맨드)을 동기화 한다.
- 클라이언트에서는 Lockstep을 저장하고 있다가 만약 서버가 끊겼을 경우 그동안 저장했던 Lockstep을 실행하여 동기화 한다.

## 게임 네트워크 구조

### 서버구조 사례

- 로그인 전용 서버, 로비기능(채팅, 상점), 매칭서버, 플레이 전용 서버 등이 별도로 구성
- 플레이 전용 서버 : 실시간 통신이 가능해야 한다.
  - 미러, 포톤, C++, C#
- DB의 경우 속도가 느리므로 자주 사용하는 데이터의 경우 미리 메모리에 로드해둠으로써 간극을 최소화

### 네트워크 구조
전통적인 서버 구조의 경우 서버실 임대료, 장비, 인건비, 유지비용 등으로 인하여 구축 비용이 크다. 최근에서는 클라우드 서버를 통해 서버를 사용한 시간에 대한 임대료만 지불하여 비용 절감을 하고 있다.

#### IaaS (Infrastructure-as-a-service)
- AWS, Azure 등
- 장비, 임대료 등 모든 인프라를 클라우드로 제공하고 사용자는 사용료만 지불하면 된다.

#### PaaS (Platforms-as-a-service)
- 운영체제, 네트워크 설정, 관리도구 등 모든 기능을 제공
- 로드밸런서, 오토스케일 기능 등을 사용 가능

#### Serverless 아키텍트 - BaaS, FaaS
##### BaaS (Backend-as-a-service)
- 구글 파이어베이스 : 인증(자체, 소셜 등)기능, API, 푸시 기능 등을 제공
##### Faas (Function-as-a-service)
- AWS 람다, Azure Function 등
- 기능을 함수 단위로 만들어 함수의 호출 횟수 및 함수 동작시간에 따라 비용을 측정한다.
- 기존의 IaaS 와 같이 서버가 켜져있는 것과는 상관없이 얼마나 함수 콜이 처리 되었느냐에 따라 비용을 측정한다.
- 크롤링 및 주기적인 처리
- 웹요청 등 

#### GBaaS (Game Beckend-as-a-Service)
- 게이밍 용 밴앤드 서비스
- 게임운영을 위한 주요 서버기능을 제공
- ex) 플레이펫, 게임 스팔스, Sparks, 포톤, 뒤끌


### 스트리밍 
- 게임, 동작, 게임 결과 조작만 입력
- 클라우드 서버에서 랜더링
- 게이머들은 최신사양의 클라이언트가 필요없음
- 플레이어는 인풋만 입력하고 클라우드 서버에서 렌더링

### 5G
- 고신뢰/초저지연 통신
 - 게임 스트리밍
- 더 낫게 플레이가 가능하다
- 게임서버 




