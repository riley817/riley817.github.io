<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ - 5ì¥ ì‚¬ìš©ìë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•œ ë°ì´í„° ì¶”ì¶œ - ë¼ì¼ë¦¬ì˜ ê°œë°œ ê¸°ë¡ì¥</title><meta name="Description" content="Riley&#39;s DevLog"><meta property="og:url" content="https://riley817.github.io/sql-recipe-5-1/">
  <meta property="og:site_name" content="ë¼ì¼ë¦¬ì˜ ê°œë°œ ê¸°ë¡ì¥">
  <meta property="og:title" content="ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ - 5ì¥ ì‚¬ìš©ìë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•œ ë°ì´í„° ì¶”ì¶œ">
  <meta property="og:description" content="ğŸ—„ï¸ ë°ì´í„°ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ ì±…ì„ ì½ê³  ì •ë¦¬ / ìš”ì•½ í•œ ë‚´ìš©ì…ë‹ˆë‹¤.
11. ì‚¬ìš©ì ì „ì²´ì˜ íŠ¹ì§•ê³¼ ê²½í–¥ ì°¾ê¸° ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì€ ì‚¬ìš©ìì—ê²Œ ê°€ì¹˜ë¥¼ ì œê³µí•˜ëŠ” ê²ƒ
ì„œë¹„ìŠ¤ ì œê³µì ì¸¡ì—ì„œ ê´€ë ¨ ì •ë³´ë¡œ ì•Œê³  ì‹¶ì€ ê²ƒ
ì‚¬ìš©ìì˜ ì†ì„±(ë‚˜ì´, ì„±ë³„, ì£¼ì†Œì§€) ì‚¬ìš©ìì˜ í–‰ë™(êµ¬ë§¤í•œ ìƒí’ˆ, ì‚¬ìš©í•œ ê¸°ëŠ¥, ì‚¬ìš©í•œ ë¹ˆë„) ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©ì ë§ˆìŠ¤í„° í…Œì´ë¸” ê°€ì…ì‹œ ì‚¬ìš©ì ì„±ë³„, ê°€ì… ë‚ ì§œ, ì‚¬ìš© ì¥ì¹˜ ë“± íƒˆí‡´ì‹œëŠ” ë‚ ì§œë§Œ ê¸°ë¡ ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸” í˜ì´ì§€ ì—´ëŒ, ê´€ì‹¬ ìƒí’ˆ ë“±ë¡, ì¹´íŠ¸ ì¶”ê°€, êµ¬ë§¤, ë¦¬ë·° ë“± ê° ì•¡ì…˜ì— ì´ë¦„ì„ ëª…ì‹œ user_idê°€ NULL ì¸ ê²½ìš° ë¹„ë¡œê·¸ì¸ íšŒì› ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸”ì„ ë”°ë¡œ ë§Œë“¤ê³  ì•¡ì…˜ ë‚´ìš©ì„ ì ì–´ë‘ë©´ ë³„ë„ì˜ JOIN, UNION ì—†ì´ ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŒ ì‚¬ìš©ì ë§ˆìŠ¤í„° í…Œì´ë¸”ê³¼ ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 -- ì‚¬ìš©ì ë§ˆìŠ¤í„° ì •ë³´ DROP TABLE IF EXISTS mst_users; CREATE TABLE mst_users( user_id varchar(255) , sex varchar(255) , birth_date varchar(255) , register_date varchar(255) , register_device varchar(255) , withdraw_date varchar(255) ); INSERT INTO mst_users VALUES (&#39;U001&#39;, &#39;M&#39;, &#39;1977-06-17&#39;, &#39;2016-10-01&#39;, &#39;pc&#39; , NULL ) , (&#39;U002&#39;, &#39;F&#39;, &#39;1953-06-12&#39;, &#39;2016-10-01&#39;, &#39;sp&#39; , &#39;2016-10-10&#39;) , (&#39;U003&#39;, &#39;M&#39;, &#39;1965-01-06&#39;, &#39;2016-10-01&#39;, &#39;pc&#39; , NULL ) , (&#39;U004&#39;, &#39;F&#39;, &#39;1954-05-21&#39;, &#39;2016-10-05&#39;, &#39;pc&#39; , NULL ) , (&#39;U005&#39;, &#39;M&#39;, &#39;1987-11-23&#39;, &#39;2016-10-05&#39;, &#39;sp&#39; , NULL ) , (&#39;U006&#39;, &#39;F&#39;, &#39;1950-01-21&#39;, &#39;2016-10-10&#39;, &#39;pc&#39; , &#39;2016-10-10&#39;) , (&#39;U007&#39;, &#39;F&#39;, &#39;1950-07-18&#39;, &#39;2016-10-10&#39;, &#39;app&#39;, NULL ) , (&#39;U008&#39;, &#39;F&#39;, &#39;2006-12-09&#39;, &#39;2016-10-10&#39;, &#39;sp&#39; , NULL ) , (&#39;U009&#39;, &#39;M&#39;, &#39;2004-10-23&#39;, &#39;2016-10-15&#39;, &#39;pc&#39; , NULL ) , (&#39;U010&#39;, &#39;F&#39;, &#39;1987-03-18&#39;, &#39;2016-10-16&#39;, &#39;pc&#39; , NULL ) ; -- ì•¡ì…˜ ë¡œê·¸ DROP TABLE IF EXISTS action_log; CREATE TABLE action_log( session varchar(255) , user_id varchar(255) , action varchar(255) , category varchar(255) , products varchar(255) , amount integer , stamp varchar(255) ); INSERT INTO action_log VALUES (&#39;989004ea&#39;, &#39;U001&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D001,D002&#39;, 2000, &#39;2016-11-03 18:10:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;view&#39; , NULL , NULL , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;favorite&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;review&#39; , &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D002&#39; , NULL, &#39;2016-11-03 18:01:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001,D002&#39;, NULL, &#39;2016-11-03 18:02:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D001,D002&#39;, 2000, &#39;2016-11-03 18:10:00&#39;) , (&#39;47db0370&#39;, &#39;U002&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 19:00:00&#39;) , (&#39;47db0370&#39;, &#39;U002&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D001&#39; , 1000, &#39;2016-11-03 20:00:00&#39;) , (&#39;47db0370&#39;, &#39;U002&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D002&#39; , NULL, &#39;2016-11-03 20:30:00&#39;) , (&#39;87b5725f&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;action&#39;, &#39;A004&#39; , NULL, &#39;2016-11-04 12:00:00&#39;) , (&#39;87b5725f&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;action&#39;, &#39;A005&#39; , NULL, &#39;2016-11-04 12:00:00&#39;) , (&#39;87b5725f&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;action&#39;, &#39;A006&#39; , NULL, &#39;2016-11-04 12:00:00&#39;) , (&#39;9afaf87c&#39;, &#39;U002&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D002&#39; , 1000, &#39;2016-11-04 13:00:00&#39;) , (&#39;9afaf87c&#39;, &#39;U001&#39;, &#39;purchase&#39;, &#39;action&#39;, &#39;A005,A006&#39;, 1000, &#39;2016-11-04 15:00:00&#39;) ; 11.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-11-24T16:40:17+09:00">
    <meta property="article:modified_time" content="2024-06-24T22:08:26+09:00">
    <meta property="article:tag" content="Data">
    <meta property="og:image" content="https://riley817.github.io/icon.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://riley817.github.io/icon.png">
  <meta name="twitter:title" content="ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ - 5ì¥ ì‚¬ìš©ìë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•œ ë°ì´í„° ì¶”ì¶œ">
  <meta name="twitter:description" content="ğŸ—„ï¸ ë°ì´í„°ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ ì±…ì„ ì½ê³  ì •ë¦¬ / ìš”ì•½ í•œ ë‚´ìš©ì…ë‹ˆë‹¤.
11. ì‚¬ìš©ì ì „ì²´ì˜ íŠ¹ì§•ê³¼ ê²½í–¥ ì°¾ê¸° ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì€ ì‚¬ìš©ìì—ê²Œ ê°€ì¹˜ë¥¼ ì œê³µí•˜ëŠ” ê²ƒ
ì„œë¹„ìŠ¤ ì œê³µì ì¸¡ì—ì„œ ê´€ë ¨ ì •ë³´ë¡œ ì•Œê³  ì‹¶ì€ ê²ƒ
ì‚¬ìš©ìì˜ ì†ì„±(ë‚˜ì´, ì„±ë³„, ì£¼ì†Œì§€) ì‚¬ìš©ìì˜ í–‰ë™(êµ¬ë§¤í•œ ìƒí’ˆ, ì‚¬ìš©í•œ ê¸°ëŠ¥, ì‚¬ìš©í•œ ë¹ˆë„) ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©ì ë§ˆìŠ¤í„° í…Œì´ë¸” ê°€ì…ì‹œ ì‚¬ìš©ì ì„±ë³„, ê°€ì… ë‚ ì§œ, ì‚¬ìš© ì¥ì¹˜ ë“± íƒˆí‡´ì‹œëŠ” ë‚ ì§œë§Œ ê¸°ë¡ ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸” í˜ì´ì§€ ì—´ëŒ, ê´€ì‹¬ ìƒí’ˆ ë“±ë¡, ì¹´íŠ¸ ì¶”ê°€, êµ¬ë§¤, ë¦¬ë·° ë“± ê° ì•¡ì…˜ì— ì´ë¦„ì„ ëª…ì‹œ user_idê°€ NULL ì¸ ê²½ìš° ë¹„ë¡œê·¸ì¸ íšŒì› ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸”ì„ ë”°ë¡œ ë§Œë“¤ê³  ì•¡ì…˜ ë‚´ìš©ì„ ì ì–´ë‘ë©´ ë³„ë„ì˜ JOIN, UNION ì—†ì´ ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŒ ì‚¬ìš©ì ë§ˆìŠ¤í„° í…Œì´ë¸”ê³¼ ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 -- ì‚¬ìš©ì ë§ˆìŠ¤í„° ì •ë³´ DROP TABLE IF EXISTS mst_users; CREATE TABLE mst_users( user_id varchar(255) , sex varchar(255) , birth_date varchar(255) , register_date varchar(255) , register_device varchar(255) , withdraw_date varchar(255) ); INSERT INTO mst_users VALUES (&#39;U001&#39;, &#39;M&#39;, &#39;1977-06-17&#39;, &#39;2016-10-01&#39;, &#39;pc&#39; , NULL ) , (&#39;U002&#39;, &#39;F&#39;, &#39;1953-06-12&#39;, &#39;2016-10-01&#39;, &#39;sp&#39; , &#39;2016-10-10&#39;) , (&#39;U003&#39;, &#39;M&#39;, &#39;1965-01-06&#39;, &#39;2016-10-01&#39;, &#39;pc&#39; , NULL ) , (&#39;U004&#39;, &#39;F&#39;, &#39;1954-05-21&#39;, &#39;2016-10-05&#39;, &#39;pc&#39; , NULL ) , (&#39;U005&#39;, &#39;M&#39;, &#39;1987-11-23&#39;, &#39;2016-10-05&#39;, &#39;sp&#39; , NULL ) , (&#39;U006&#39;, &#39;F&#39;, &#39;1950-01-21&#39;, &#39;2016-10-10&#39;, &#39;pc&#39; , &#39;2016-10-10&#39;) , (&#39;U007&#39;, &#39;F&#39;, &#39;1950-07-18&#39;, &#39;2016-10-10&#39;, &#39;app&#39;, NULL ) , (&#39;U008&#39;, &#39;F&#39;, &#39;2006-12-09&#39;, &#39;2016-10-10&#39;, &#39;sp&#39; , NULL ) , (&#39;U009&#39;, &#39;M&#39;, &#39;2004-10-23&#39;, &#39;2016-10-15&#39;, &#39;pc&#39; , NULL ) , (&#39;U010&#39;, &#39;F&#39;, &#39;1987-03-18&#39;, &#39;2016-10-16&#39;, &#39;pc&#39; , NULL ) ; -- ì•¡ì…˜ ë¡œê·¸ DROP TABLE IF EXISTS action_log; CREATE TABLE action_log( session varchar(255) , user_id varchar(255) , action varchar(255) , category varchar(255) , products varchar(255) , amount integer , stamp varchar(255) ); INSERT INTO action_log VALUES (&#39;989004ea&#39;, &#39;U001&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D001,D002&#39;, 2000, &#39;2016-11-03 18:10:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;view&#39; , NULL , NULL , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;favorite&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;review&#39; , &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 18:00:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D002&#39; , NULL, &#39;2016-11-03 18:01:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001,D002&#39;, NULL, &#39;2016-11-03 18:02:00&#39;) , (&#39;989004ea&#39;, &#39;U001&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D001,D002&#39;, 2000, &#39;2016-11-03 18:10:00&#39;) , (&#39;47db0370&#39;, &#39;U002&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D001&#39; , NULL, &#39;2016-11-03 19:00:00&#39;) , (&#39;47db0370&#39;, &#39;U002&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D001&#39; , 1000, &#39;2016-11-03 20:00:00&#39;) , (&#39;47db0370&#39;, &#39;U002&#39;, &#39;add_cart&#39;, &#39;drama&#39; , &#39;D002&#39; , NULL, &#39;2016-11-03 20:30:00&#39;) , (&#39;87b5725f&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;action&#39;, &#39;A004&#39; , NULL, &#39;2016-11-04 12:00:00&#39;) , (&#39;87b5725f&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;action&#39;, &#39;A005&#39; , NULL, &#39;2016-11-04 12:00:00&#39;) , (&#39;87b5725f&#39;, &#39;U001&#39;, &#39;add_cart&#39;, &#39;action&#39;, &#39;A006&#39; , NULL, &#39;2016-11-04 12:00:00&#39;) , (&#39;9afaf87c&#39;, &#39;U002&#39;, &#39;purchase&#39;, &#39;drama&#39; , &#39;D002&#39; , 1000, &#39;2016-11-04 13:00:00&#39;) , (&#39;9afaf87c&#39;, &#39;U001&#39;, &#39;purchase&#39;, &#39;action&#39;, &#39;A005,A006&#39;, 1000, &#39;2016-11-04 15:00:00&#39;) ; 11.">
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://riley817.github.io/sql-recipe-5-1/" /><link rel="prev" href="https://riley817.github.io/bigquery-datagrip/" /><link rel="next" href="https://riley817.github.io/sql-recipe-5-2/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ - 5ì¥ ì‚¬ìš©ìë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•œ ë°ì´í„° ì¶”ì¶œ",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/riley817.github.io\/sql-recipe-5-1\/"
        },"image": ["https:\/\/riley817.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "data","wordcount":  5576 ,
        "url": "https:\/\/riley817.github.io\/sql-recipe-5-1\/","datePublished": "2022-11-24T16:40:17+09:00","dateModified": "2024-06-24T22:08:26+09:00","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/riley817.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "riley"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="ë¼ì¼ë¦¬ì˜ ê°œë°œ ê¸°ë¡ì¥"><span class="header-title-pre"><i class='fa-brands fa-github-alt'></i>&nbsp;</span>ë¼ì¼ë¦¬ì˜ ê°œë°œ ê¸°ë¡ì¥</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="ë¼ì¼ë¦¬ì˜ ê°œë°œ ê¸°ë¡ì¥"><span class="header-title-pre"><i class='fa-brands fa-github-alt'></i>&nbsp;</span>ë¼ì¼ë¦¬ì˜ ê°œë°œ ê¸°ë¡ì¥</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ - 5ì¥ ì‚¬ìš©ìë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•œ ë°ì´í„° ì¶”ì¶œ</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/riley817" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>riley</a></span>&nbsp;<span class="post-category">included in <a href="/categories/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D%EC%9D%84-%EC%9C%84%ED%95%9C-sql-%EB%A0%88%EC%8B%9C%ED%94%BC/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-11-24">2022-11-24</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;5576 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;27 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#11-ì‚¬ìš©ì-ì „ì²´ì˜-íŠ¹ì§•ê³¼-ê²½í–¥-ì°¾ê¸°">11. ì‚¬ìš©ì ì „ì²´ì˜ íŠ¹ì§•ê³¼ ê²½í–¥ ì°¾ê¸°</a>
      <ul>
        <li><a href="#ìƒ˜í”Œ-ë°ì´í„°">ìƒ˜í”Œ ë°ì´í„°</a></li>
        <li><a href="#111-ì‚¬ìš©ìì˜-ì•¡ì…˜-ìˆ˜-ì§‘ê³„í•˜ê¸°">11.1 ì‚¬ìš©ìì˜ ì•¡ì…˜ ìˆ˜ ì§‘ê³„í•˜ê¸°</a>
          <ul>
            <li><a href="#ì•¡ì…˜ê³¼-ê´€ë ¨ëœ-ì§€í‘œ-ì§‘ê³„í•˜ê¸°">ì•¡ì…˜ê³¼ ê´€ë ¨ëœ ì§€í‘œ ì§‘ê³„í•˜ê¸°</a></li>
            <li><a href="#ë¡œê·¸ì¸-ì‚¬ìš©ìì™€-ë¹„ë¡œê·¸ì¸-ì‚¬ìš©ìë¥¼-êµ¬ë¶„í•´ì„œ-ì§‘ê³„í•˜ê¸°">ë¡œê·¸ì¸ ì‚¬ìš©ìì™€ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•´ì„œ ì§‘ê³„í•˜ê¸°</a></li>
            <li><a href="#íšŒì›ê³¼-ë¹„íšŒì›ì„-êµ¬ë¶„í•´ì„œ-ì§‘ê³„í•˜ê¸°">íšŒì›ê³¼ ë¹„íšŒì›ì„ êµ¬ë¶„í•´ì„œ ì§‘ê³„í•˜ê¸°</a></li>
          </ul>
        </li>
        <li><a href="#112-ì—°ë ¹ë³„-êµ¬ë¶„-ì§‘ê³„í•˜ê¸°">11.2 ì—°ë ¹ë³„ êµ¬ë¶„ ì§‘ê³„í•˜ê¸°</a></li>
        <li><a href="#113-ì—°ë ¹ë³„-êµ¬ë¶„ì˜-íŠ¹ì§•-ì¶”ì¶œí•˜ê¸°">11.3 ì—°ë ¹ë³„ êµ¬ë¶„ì˜ íŠ¹ì§• ì¶”ì¶œí•˜ê¸°</a></li>
        <li><a href="#114-ì‚¬ìš©ìì˜-ë°©ë¬¸-ë¹ˆë„-ì§‘ê³„í•˜ê¸°">11.4 ì‚¬ìš©ìì˜ ë°©ë¬¸ ë¹ˆë„ ì§‘ê³„í•˜ê¸°</a></li>
        <li><a href="#115-ë²¤-ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ-ì‚¬ìš©ì-ì•¡ì…˜-ì§‘ê³„í•˜ê¸°">11.5 ë²¤ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì‚¬ìš©ì ì•¡ì…˜ ì§‘ê³„í•˜ê¸°</a></li>
        <li><a href="#116-decile-ë¶„ì„ì„-ì‚¬ìš©í•´-ì‚¬ìš©ìë¥¼-10ë‹¨ê³„-ê·¸ë£¹ìœ¼ë¡œ-ë‚˜ëˆ„ê¸°">11.6 Decile ë¶„ì„ì„ ì‚¬ìš©í•´ ì‚¬ìš©ìë¥¼ 10ë‹¨ê³„ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ê¸°</a>
          <ul>
            <li><a href="#decile-ë¶„ì„-ê³¼ì •">Decile ë¶„ì„ ê³¼ì •</a></li>
          </ul>
        </li>
        <li><a href="#117-rfm-ë¶„ì„ìœ¼ë¡œ-ì‚¬ìš©ìë¥¼-ì„¸-ê°€ì§€--ê·¸ë£¹ìœ¼ë¡œ-ë‚˜ëˆ„ê¸°">11.7 RFM ë¶„ì„ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ì„¸ ê°€ì§€  ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ê¸°</a>
          <ul>
            <li><a href="#rfm-ë¶„ì„ì˜-ì„¸ê°€ì§€-ì§€í‘œ-ì§‘ê³„í•˜ê¸°">RFM ë¶„ì„ì˜ ì„¸ê°€ì§€ ì§€í‘œ ì§‘ê³„í•˜ê¸°</a></li>
            <li><a href="#rfm-ë­í¬ì •ì˜í•˜ê¸°">RFM ë­í¬ì •ì˜í•˜ê¸°</a></li>
            <li><a href="#ì‚¬ìš©ìë¥¼-1ì°¨ì›ìœ¼ë¡œ-êµ¬ë¶„í•˜ê¸°">ì‚¬ìš©ìë¥¼ 1ì°¨ì›ìœ¼ë¡œ êµ¬ë¶„í•˜ê¸°</a></li>
            <li><a href="#2ì°¨ì›ìœ¼ë¡œ-ì‚¬ìš©ì-ì¸ì‹í•˜ê¸°">2ì°¨ì›ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì‹í•˜ê¸°</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>ğŸ—„ï¸ ë°ì´í„°ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ ì±…ì„ ì½ê³  ì •ë¦¬ / ìš”ì•½ í•œ ë‚´ìš©ì…ë‹ˆë‹¤.</p>
</blockquote>
<h2 id="11-ì‚¬ìš©ì-ì „ì²´ì˜-íŠ¹ì§•ê³¼-ê²½í–¥-ì°¾ê¸°">11. ì‚¬ìš©ì ì „ì²´ì˜ íŠ¹ì§•ê³¼ ê²½í–¥ ì°¾ê¸°</h2>
<ul>
<li>
<p><strong>ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì€ ì‚¬ìš©ìì—ê²Œ ê°€ì¹˜ë¥¼ ì œê³µí•˜ëŠ” ê²ƒ</strong></p>
</li>
<li>
<p>ì„œë¹„ìŠ¤ ì œê³µì ì¸¡ì—ì„œ ê´€ë ¨ ì •ë³´ë¡œ ì•Œê³  ì‹¶ì€ ê²ƒ</p>
<ul>
<li>ì‚¬ìš©ìì˜ ì†ì„±(ë‚˜ì´, ì„±ë³„, ì£¼ì†Œì§€)</li>
<li>ì‚¬ìš©ìì˜ í–‰ë™(êµ¬ë§¤í•œ ìƒí’ˆ, ì‚¬ìš©í•œ ê¸°ëŠ¥, ì‚¬ìš©í•œ ë¹ˆë„)</li>
</ul>
</li>
</ul>
<h3 id="ìƒ˜í”Œ-ë°ì´í„°">ìƒ˜í”Œ ë°ì´í„°</h3>
<ul>
<li><strong>ì‚¬ìš©ì ë§ˆìŠ¤í„° í…Œì´ë¸”</strong>
<ul>
<li>ê°€ì…ì‹œ ì‚¬ìš©ì ì„±ë³„, ê°€ì… ë‚ ì§œ, ì‚¬ìš© ì¥ì¹˜ ë“±</li>
<li>íƒˆí‡´ì‹œëŠ” ë‚ ì§œë§Œ ê¸°ë¡</li>
</ul>
</li>
<li><strong>ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸”</strong>
<ul>
<li>í˜ì´ì§€ ì—´ëŒ, ê´€ì‹¬ ìƒí’ˆ ë“±ë¡, ì¹´íŠ¸ ì¶”ê°€, êµ¬ë§¤, ë¦¬ë·° ë“± ê° ì•¡ì…˜ì— ì´ë¦„ì„ ëª…ì‹œ</li>
<li><code>user_id</code>ê°€ NULL ì¸ ê²½ìš° ë¹„ë¡œê·¸ì¸ íšŒì›</li>
<li>ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸”ì„ ë”°ë¡œ ë§Œë“¤ê³  ì•¡ì…˜ ë‚´ìš©ì„ ì ì–´ë‘ë©´ ë³„ë„ì˜ JOIN, UNION ì—†ì´ ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŒ</li>
</ul>
</li>
</ul>
<div class="details admonition abstract">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ul fa-fw" aria-hidden="true"></i>ì‚¬ìš©ì ë§ˆìŠ¤í„° í…Œì´ë¸”ê³¼ ì•¡ì…˜ ë¡œê·¸ í…Œì´ë¸”<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- ì‚¬ìš©ì ë§ˆìŠ¤í„° ì •ë³´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">mst_users</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mst_users</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_id</span><span class="w">         </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="w">             </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">birth_date</span><span class="w">      </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">register_date</span><span class="w">   </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">register_device</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">withdraw_date</span><span class="w">   </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">mst_users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1977-06-17&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pc&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U002&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1953-06-12&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sp&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-10&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U003&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1965-01-06&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pc&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U004&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1954-05-21&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-05&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pc&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U005&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1987-11-23&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-05&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sp&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U006&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1950-01-21&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-10&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pc&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-10&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U007&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1950-07-18&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-10&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;app&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U008&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2006-12-09&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-10&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sp&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U009&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2004-10-23&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-15&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pc&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;U010&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1987-03-18&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-16&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pc&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ì•¡ì…˜ ë¡œê·¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">action_log</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">action_log</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">session</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="w">   </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">   </span><span class="nb">integer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">stamp</span><span class="w">    </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001,D002&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:10:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;view&#39;</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w">       </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;favorite&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;review&#39;</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D002&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:01:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001,D002&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:02:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;989004ea&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001,D002&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 18:10:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;47db0370&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U002&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 19:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;47db0370&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U002&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D001&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 20:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;47db0370&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U002&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D002&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-03 20:30:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;87b5725f&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A004&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-04 12:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;87b5725f&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A005&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-04 12:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;87b5725f&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;add_cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A006&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-04 12:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;9afaf87c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U002&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;drama&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D002&#39;</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-04 13:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;9afaf87c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U001&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A005,A006&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-11-04 15:00:00&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<h3 id="111-ì‚¬ìš©ìì˜-ì•¡ì…˜-ìˆ˜-ì§‘ê³„í•˜ê¸°">11.1 ì‚¬ìš©ìì˜ ì•¡ì…˜ ìˆ˜ ì§‘ê³„í•˜ê¸°</h3>
<hr>
<h4 id="ì•¡ì…˜ê³¼-ê´€ë ¨ëœ-ì§€í‘œ-ì§‘ê³„í•˜ê¸°">ì•¡ì…˜ê³¼ ê´€ë ¨ëœ ì§€í‘œ ì§‘ê³„í•˜ê¸°</h4>
<ul>
<li>ì‚¬ìš©ìë“¤ì´ íŠ¹ì • ê¸°ê°„ë™ì•ˆ ì–¼ë§ˆë‚˜ ì‚¬ìš©í•˜ëŠ”ì§€ ì§‘ê³„í•œë‹¤.</li>
<li>ì‚¬ìš©ìê°€ í‰ê· ì ìœ¼ë¡œ ì•¡ì…˜ì„ ëª‡ë²ˆ ì´ë‚˜ í–ˆëŠ”ì§€ë„ ì§‘ê³„ (1ëª…ë‹¹ ì•¡ì…˜ ìˆ˜)</li>
<li><code>UU(Unique Users)</code> : ì¤‘ë³µ ì—†ì´ ì§‘ê³„ëœ ì‚¬ìš©ì ìˆ˜</li>
<li><code>íŠ¹ì • ì•¡ì…˜ UU / ì „ì²´ ì•¡ì…˜ UU = ì‚¬ìš©ìœ¨(usage_rate)</code></li>
</ul>
<p><strong>ì•¡ì…˜ ìˆ˜ì™€ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<ul>
<li>ì „ì²´ UUë¥¼ êµ¬í•˜ê³  ê·¸ ê°’ì„ <code>CROSS JOIN</code> í•˜ì—¬ ì•¡ì…˜ ë¡œê·¸ë¥¼ ê²°í•©</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- ë¡œê·¸ ì „ì²´ì˜ ìœ ë‹ˆí¬ ì‚¬ìš©ì ìˆ˜ êµ¬í•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">session</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_uu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">l</span><span class="p">.</span><span class="n">action</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="k">session</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">action_uu</span><span class="w">      </span><span class="c1">-- ì•¡ì…˜ UU
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">                  </span><span class="k">AS</span><span class="w"> </span><span class="n">action_count</span><span class="w">   </span><span class="c1">-- ì•¡ì…˜ ìˆ˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">total_uu</span><span class="w">                                  </span><span class="c1">-- ì „ì²´ UU
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- ì‚¬ìš©ë¥  : ì•¡ì…˜ UU / ì „ì²´ UU
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="k">session</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">total_uu</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">usage_rate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- 1ì¸ë‹¹ ì•¡ì…˜ ìˆ˜ : ì•¡ì…˜ ìˆ˜ / ì•¡ì…˜ UU
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="k">session</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_per_user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">l</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="c1">-- ë¡œê·¸ ì „ì²´ì˜ ìœ ë‹ˆí¬ ì‚¬ìš©ì ìˆ˜ë¥¼ ëª¨ë“  ë ˆì½”ë“œì— ê²°í•©í•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">total_uu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ë¡œê·¸ì¸-ì‚¬ìš©ìì™€-ë¹„ë¡œê·¸ì¸-ì‚¬ìš©ìë¥¼-êµ¬ë¶„í•´ì„œ-ì§‘ê³„í•˜ê¸°">ë¡œê·¸ì¸ ì‚¬ìš©ìì™€ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•´ì„œ ì§‘ê³„í•˜ê¸°</h4>
<ul>
<li>íšŒì›, ë¹„íšŒì›ì„ ë‚˜ëˆ„ì–´ ì§‘ê³„í•˜ë©´ ì¶©ì„±ë„ê°€ ë†’ì€ ì‚¬ìš©ìì™€ ë‚®ì€ ì‚¬ìš©ìê°€ ì–´ë–¤ ê²½í–¥ì„ ë³´ì´ëŠ”ì§€ íŒŒì•…</li>
<li>ë¡œê·¸ì¸, ë¹„ë¡œê·¸ì¸, íšŒì›, ë¹„íšŒì›ì„ íŒë³„í•˜ê¸° ìœ„í•´ì„œëŠ” <strong>ë¡œê·¸ ë°ì´í„°ì— <code>session</code> ì •ë³´</strong>ê°€ ìˆì–´ì•¼ í•œë‹¤.</li>
</ul>
<p><strong>ë¡œê·¸ì¸ ìƒíƒœë¥¼ íŒë³„í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<ul>
<li><code>user_id</code> ì—¬ë¶€ì— ë”°ë¼ <code>login_status</code>ë¥¼ <code>login</code>ê³¼ <code>guest</code>ë¡œ êµ¬ë¶„</li>
<li><code>login_status</code> ê¸°ë°˜ìœ¼ë¡œ ì•¡ì…˜ ìˆ˜, UU ì§‘ê³„</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">action_log_with_status</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">session</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- user_id ê°€ NULL ë˜ëŠ” ë¹ˆ ë¬¸ìê°€ ì•„ë‹Œ ê²½ìš° login ì´ë¼ íŒì •í•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;login&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;guest&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">login_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_log_with_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ì•¡ì…˜ ìˆ˜ ë“±ì„ ë”°ë¡œ ì§‘ê³„í•˜ëŠ” ì¿¼ë¦¬(ROLLUP í™œìš©)</strong></p>
<ul>
<li><code>login_status</code>ê°€ ë¹„ë¡œê·¸ì¸<code>guest</code>/ë¡œê·¸ì¸<code>logint</code> ìƒê´€ì—†ì´ ì „ì²´<code>all</code>ë¡œ ì§‘ê³„</li>
<li><code>ROLLUP</code> êµ¬ë¬¸ì„ ì‚¬ìš© : RedShift, BigQueryëŠ” <code>UNION ALL</code> ì‚¬ìš©</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">action_log_with_status</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">session</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- user_id ê°€ NULL ë˜ëŠ” ë¹ˆ ë¬¸ìê°€ ì•„ë‹Œ ê²½ìš° login ì´ë¼ íŒì •í•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;login&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;guest&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">login_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">action</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">login_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">login_status</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">login_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">session</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">action_uu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">action_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">action_log_with_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- PostgreSQL, SparkSQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">ROLLUP</span><span class="p">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">login_status</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Hive ì˜ ê²½ìš°
</span></span></span><span class="line"><span class="cl"><span class="c1">-- action, login_status WITH ROLLUP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="íšŒì›ê³¼-ë¹„íšŒì›ì„-êµ¬ë¶„í•´ì„œ-ì§‘ê³„í•˜ê¸°">íšŒì›ê³¼ ë¹„íšŒì›ì„ êµ¬ë¶„í•´ì„œ ì§‘ê³„í•˜ê¸°</h4>
<ul>
<li>ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹ˆë”ë¼ë„ ì´ì „ì— í•œë²ˆì´ë¼ë„ ë¡œê·¸ì¸ í–ˆë‹¤ë©´ íšŒì›ìœ¼ë¡œ ê³„ì‚°í•˜ê¸°</li>
<li>ë¡œê·¸ ë°ì´í„°ì— íšŒì›ìƒíƒœë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤.</li>
<li><code>action_log_with_status</code> ê°€ìƒ í…Œì´ë¸”ì— íšŒì›ìƒíƒœë¥¼ ì¶”ê°€í•¨</li>
</ul>
<p><strong>íšŒì› ìƒíƒœë¥¼ íŒë³„í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<ul>
<li><code>session</code>ì— í•œ ë²ˆì´ë¼ë„ ë¡œê·¸ì¸í–ˆë‹¤ë©´ <code>MAX(user_id)</code> ë¡œ ì¶”ì¶œ í•  ìˆ˜ ìˆìŒ</li>
<li>ë¡œê·¸ì¸ í•˜ê¸° ì´ì „ì˜ ìƒíƒœë¥¼ ë¹„íšŒì›ìœ¼ë¡œ ë‹¤ë£¨ê³  ì‹¶ë‹¤ë©´ ë‚´ë¶€ì— <code>ORDER BY stamp</code>ë¥¼ ì§€ì •</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">action_log_with_status</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">session</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- ë¡œê·¸ë¥¼ íƒ€ì„ìŠ¤íƒ¬í”„ ìˆœì„œë¡œ ë‚˜ì—´í•˜ê³ , í•œë²ˆì´ë¼ë„ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì¼ ê²½ìš° ì´í›„ì˜ ëª¨ë“  ë¡œê·¸ ìƒíƒœë¥¼ memberë¡œ ì„¤ì •
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">stamp</span><span class="w"> </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">UNBOUNDED</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;member&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">member_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">stamp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_log_with_status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ ì§€ì •í•œ ê²½ìš° <code>COUNT(DISTINCT user_id)</code> ì˜ ê²°ê³¼ì— í¬í•¨ëœë‹¤.</li>
<li>ì‚¬ìš©ì ìˆ˜ë¥¼ ì •í™”í•˜ê²Œ ì¶”ì¶œí•˜ë ¤ë©´ ì‚¬ìš©ì IDë¥¼ NULLë¡œ ì§€ì •</li>
<li>ë¹ˆ ê°’ì„ NULL, ë¹ˆë¬¸ìì—´ í˜¹ì€ íŠ¹ìˆ˜í•œ ê°’ìœ¼ë¡œ ë‚˜íƒ€ë‚¼ì§€ëŠ” ì¿¼ë¦¬ ìµœì í™”ì— ë”°ë¼ ë‹¤ë¦„</li>
</ul>
</div>
        </div>
    </div>
<h3 id="112-ì—°ë ¹ë³„-êµ¬ë¶„-ì§‘ê³„í•˜ê¸°">11.2 ì—°ë ¹ë³„ êµ¬ë¶„ ì§‘ê³„í•˜ê¸°</h3>
<hr>
<ul>
<li>ì‚¬ìš©ìì˜ ì†ì„±ì„ ì •ì˜í•˜ê³  ì§‘ê³„í•˜ë©´ ë‹¤ì–‘í•œ ë¦¬í¬íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ</li>
<li>ì‹œì²­ë¥  ë¶„ì„ì— ë§ì´ ì‚¬ìš©ë˜ëŠ” ì—°ë ¹ë³„ ì§‘ê³„í•˜ê¸°</li>
</ul>
<p><strong>ì—°ë ¹ë³„ êµ¬ë¶„ ëª©ë¡</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">ì—°ë ¹ë³„ êµ¬ë¶„</th>
<th style="text-align:center">ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">C</td>
<td style="text-align:center">4~12ì„¸ ë‚¨ì„±/ì—¬ì„±</td>
</tr>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">13~19ì„¸ ë‚¨ì„±/ì—¬ì„±</td>
</tr>
<tr>
<td style="text-align:center">M1</td>
<td style="text-align:center">20~34 ë‚¨ì„±</td>
</tr>
<tr>
<td style="text-align:center">M2</td>
<td style="text-align:center">35~49 ë‚¨ì„±</td>
</tr>
<tr>
<td style="text-align:center">M3</td>
<td style="text-align:center">50ì„¸ ì´ìƒ ë‚¨ì„±</td>
</tr>
<tr>
<td style="text-align:center">F1</td>
<td style="text-align:center">20~34 ì—¬ì„±</td>
</tr>
<tr>
<td style="text-align:center">F2</td>
<td style="text-align:center">35~49 ì—¬ì„±</td>
</tr>
<tr>
<td style="text-align:center">F3</td>
<td style="text-align:center">50ì„¸ ì´ìƒ ì—¬ì„±</td>
</tr>
</tbody>
</table>
<p><strong>ì‚¬ìš©ìì˜ ìƒì¼ì„ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<ul>
<li><code>mst_users_with_int_birth_date</code> : ìƒì¼ê³¼ íŠ¹ì • ë‚ ì§œë¥¼ ì •ìˆ˜ë¡œ í‘œí˜„í•œ ê²°ê³¼ ì„ì‹œ í…Œì´ë¸”</li>
<li><code>mst_users_with_age</code> : ìƒì¼ ì •ë³´ë¥¼ ë¶€ì—¬í•œ ì‚¬ìš©ì ë§ˆìŠ¤í„°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- íŠ¹ì • ë‚ ì§œ(2017ë…„ 1ì›” 1ì¼)ì˜ ì •ìˆ˜ í‘œí˜„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">20170101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_specific_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- ë¬¸ìì—´ë¡œ êµ¬ì„±ëœ ìƒë…„ì›”ì¼ì„ ì •ìˆ˜ í‘œí˜„ìœ¼ë¡œ ë³€í™˜í•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">-- PostgreSQL, Redshift ì˜ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">--, CAST(replace(substring(birth_date, 1, 10), &#39;-&#39;, &#39;&#39;) AS int64) AS int_birth_date
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- BigQuery ì˜ ê²½ìš°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">replace</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">birth_date</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- Hive, SparkSQL ì˜ ê²½ìš°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">--, CAST(regexp_replace(substring(birth_date, 1, 10), &#39;-&#39;, &#39;&#39;) AS int) AS int_birth_Date
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">mst_users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_users_with_age</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">floor</span><span class="p">((</span><span class="n">int_specific_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">int_birth_date</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">birth_date</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ì„±ë³„ê³¼ ì—°ë ¹ìœ¼ë¡œ ì—°ë ¹ë³„ êµ¬ë¶„í•˜ëŠ” ê³„ì‚° ì¿¼ë¦¬</strong></p>
<ul>
<li><code>cagetory</code> ì»¬ëŸ¼ì—ì„œ ì—°ë ¹ë³„ êµ¬ë¶„ì„ ê³„ì‚°</li>
<li>20ì„¸ ì´ìƒì¼ ê²½ìš° ì ‘ë‘ì‚¬ <code>M</code>, <code>F</code>ë¥¼ ê³„ì‚°í•˜ê³  <code>CONCAT</code> í•¨ìˆ˜ë¡œ ê²°í•©</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">20170101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_specific_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">replace</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">birth_date</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">mst_users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_users_with_age</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">floor</span><span class="p">((</span><span class="n">int_specific_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">int_birth_date</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_users_with_category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ì—°ë ¹ë³„ êµ¬ë¶„ì˜ ì‚¬ëŒ ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">20170101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_specific_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">replace</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">birth_date</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">mst_users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_users_with_age</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">floor</span><span class="p">((</span><span class="n">int_specific_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">int_birth_date</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_users_with_category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">user_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>ì—°ë ¹ì„ ë‹¨ìˆœí•˜ê²Œ ê³„ì‚°í•˜ë©´ íŠ¹ì§•ì„ íŒŒì•…í•˜ê¸° ì–´ë µê³  ë°ëª¨ê·¸ë˜í”½<code>Demographic</code> ë“±ì— í™œìš©í•˜ê¸° ì–´ë ¤ì›€</li>
<li>ì„œë¹„ìŠ¤ì— ë”°ë¼ <code>M1</code>, <code>F1</code>ìœ¼ë¡œ ì •ì˜í•˜ëŠ” ê²ƒì´ ì ì ˆí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ : ìƒˆë¡œìš´ ê¸°ì¤€ì„ ì •ì˜</li>
</ul>
</div>
        </div>
    </div>
<h3 id="113-ì—°ë ¹ë³„-êµ¬ë¶„ì˜-íŠ¹ì§•-ì¶”ì¶œí•˜ê¸°">11.3 ì—°ë ¹ë³„ êµ¬ë¶„ì˜ íŠ¹ì§• ì¶”ì¶œí•˜ê¸°</h3>
<hr>
<ul>
<li>ì—°ë ¹ë³„ êµ¬ë¶„ì„ ì‚¬ìš©í•˜ì—¬ ê°ê° êµ¬ë§¤í•œ ìƒí’ˆì˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì§‘ê³„í•˜ê¸°</li>
<li>ì¹´í…Œê³ ë¦¬ ë‚´ë¶€ì—ì„œ ì—°ë ¹ë³„ ë¶„í¬ í™•ì¸ ê°€ëŠ¥
<strong>ì—°ë ¹ë³„ êµ¬ë¶„ê³¼ ì¹´í…Œê³ ë¦¬ë¥¼ ì§‘ê³„í•˜ëŠ” ì¿¼ë¦¬</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">20170101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_specific_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">replace</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">birth_date</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">mst_users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_users_with_age</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">floor</span><span class="p">((</span><span class="n">int_specific_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">int_birth_date</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_int_birth_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_users_with_category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">WHEN</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_users_with_age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">product_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">user_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="n">purchase_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">mst_users_with_category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="114-ì‚¬ìš©ìì˜-ë°©ë¬¸-ë¹ˆë„-ì§‘ê³„í•˜ê¸°">11.4 ì‚¬ìš©ìì˜ ë°©ë¬¸ ë¹ˆë„ ì§‘ê³„í•˜ê¸°</h3>
<hr>
<ul>
<li>ì„œë¹„ìŠ¤ë¥¼ í•œ ì£¼ ë™ì•ˆ ë©°ì¹  ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ìê°€ ëª‡ ëª…ì¸ì§€ë¥¼ ì§‘ê³„</li>
<li><strong>ì¼ì£¼ì¼ ë™ì•ˆ ì‚¬ìš©ì ì‚¬ìš© ì¼ìˆ˜ì™€ êµ¬ì„±ë¹„</strong>ë¥¼ ì§‘ê³„</li>
</ul>
<p><strong>í•œ ì£¼ì— ë©°ì¹  ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ì§‘ê³„</strong></p>
<ul>
<li><code>action_log</code> í…Œì´ë¸”ì— ì‚¬ìš©ìë³„ IDë¡œ <code>DISTINCT</code>ë¥¼ ì ìš©í•˜ì—¬ ì‚¬ìš©ì¼ìˆ˜ ì§‘ê³„</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">action_log_with_dt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- íƒ€ì„ìŠ¤íƒ¬í”„ì—ì„œ ë‚ ì§œ ì¶”ì¶œí•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">-- PostgreSQL, Hive, Redshift, SparkSQL : substring ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">-- substring(stamp, 1, 10) AS dt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">-- PostgreSQL, Hive, BigQuery, SparkSQL : substr ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">action_day_count_per_user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_log_with_dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- 2016ë…„ 11ì›” 1ì¼ë¶€í„° 11ì›” 7ì¼ê¹Œì§€ì˜ í•œ ì£¼ ë™ì•ˆì„ ëŒ€ìƒìœ¼ë¡œ ì„ ì •
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2016-10-11&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2016-11-07&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">user_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">action_day_count_per_user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>êµ¬ì„±ë¹„ì™€ êµ¬ì„±ë¹„ëˆ„ê³„ë¥¼ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">action_log_with_dt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- íƒ€ì„ìŠ¤íƒ¬í”„ì—ì„œ ë‚ ì§œ ì¶”ì¶œí•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">-- PostgreSQL, Hive, Redshift, SparkSQL : substring ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">-- substring(stamp, 1, 10) AS dt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">-- PostgreSQL, Hive, BigQuery, SparkSQL : substr ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">action_day_count_per_user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_log_with_dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- 2016ë…„ 11ì›” 1ì¼ë¶€í„° 11ì›” 7ì¼ê¹Œì§€ì˜ í•œ ì£¼ ë™ì•ˆì„ ëŒ€ìƒìœ¼ë¡œ ì„ ì •
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2016-10-11&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2016-11-07&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">user_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- êµ¬ì„±ë¹„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">composition_ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- êµ¬ì„±ë¹„ëˆ„ê³„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">action_day_count</span><span class="w"> </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">UNBOUNDED</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="o">/</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">camulative_ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">action_day_count_per_user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">action_day_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="115-ë²¤-ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ-ì‚¬ìš©ì-ì•¡ì…˜-ì§‘ê³„í•˜ê¸°">11.5 ë²¤ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì‚¬ìš©ì ì•¡ì…˜ ì§‘ê³„í•˜ê¸°</h3>
<hr>
<ul>
<li>ì„œë¹„ìŠ¤ ë‚´ì˜ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ì‚¬ìš© í˜„í™©ì„ ì¡°ì‚¬í•˜ì—¬ ì˜ˆìƒëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•¨</li>
<li><code>has_purchase</code>, <code>has_review</code>, <code>has_ravorite</code> : ë“±ë¡ì•¡ì…˜í•œ ê²½ìš° 1, ì•„ë‹Œê²½ìš° 0</li>
<li>ë°ì´í„° íˆ´ì— ë”°ë¼ ê³§ë°”ë¡œ ë²¤ ë‹¤ì´ì–´ê·¸ë¨ì„ ë§Œë“¤ì–´ ì£¼ëŠ” ê¸°ëŠ¥ ì¡´ì¬</li>
</ul>
<p><strong>ì‚¬ìš©ìë“¤ì˜ ì•¡ì…˜ í”Œë˜ê·¸ë¥¼ ì§‘ê³„í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;review&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;favorite&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="n">active_venn_diagram</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">CUBE</span><span class="p">(</span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">active_venn_diagram</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ëª¨ë“  ì•¡ì…˜ ì¡°í•©ì— ëŒ€í•œ ì‚¬ìš©ì ìˆ˜ ê³„ì‚°í•˜ê¸°</strong></p>
<ul>
<li>ë²¤ ë‹¤ì´ì–´ê·¸ë¨ì„ ê·¸ë¦¬ê¸° ìœ„í•´ì„œëŠ” <code>êµ¬ë§¤ ì•¡ì…˜ë§Œ í•œ ì‚¬ìš©ì ìˆ˜</code>, <code>êµ¬ë§¤ì™€ ë¦¬ë·° ì•¡ì…˜ì„ í•œ ì‚¬ìš©ì ìˆ˜</code> ì²˜ëŸ¼ í•˜ë‚˜ì˜ ì•¡ì…˜ ë‘ ê°±ì˜ ì•¡ì…˜ì„ ëª‡ ëª…ì¸ì§€ ê³„ì‚°í•„ìš”</li>
<li>PostgreSQL : <code>CUBE</code> êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ì‰½ê³„ ê³„ì‚°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- PostgreSQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">WITH</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;review&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;favorite&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="n">active_venn_diagram</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">CUBE</span><span class="p">(</span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">active_venn_diagram</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>CUBE êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í‘œì¤€ SQL êµ¬ë¬¸ìœ¼ë¡œ ì‘ì„±í•œ ì¿¼ë¦¬</strong></p>
<ul>
<li><code>UNION ALL</code>ì„ ë§ì´ ì‚¬ìš©í•˜ë¯€ë¡œ ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šë‹¤.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- ì‚¬ìš©ìê°€ ì•¡ì…˜ì„ í–ˆìœ¼ë©´ 1, ì•ˆí–ˆìœ¼ë©´ 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;review&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;favorite&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">action_venn_diagram</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- ëª¨ë“  ì•¡ì…˜ ì¡°í•©ì„ ê°œë³„ì ìœ¼ë¡œ êµ¬í•˜ê³  UNION ALLë¡œ ê²°í•©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- 3ê°œì˜ ì•¡ì…˜ì„ ëª¨ë‘ í•œ ê²½ìš° ì§‘ê³„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- 3ê°œì˜ ì•¡ì…˜ ì¤‘ 2ê°œì˜ ì•¡ì…˜ì„ í•œ ê²½ìš° ì§‘ê³„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- 3ê°œì˜ ì•¡ì…˜ ì¤‘ 1ê°œì˜ ì•¡ì…˜ì„ í•œ ê²½ìš° ì§‘ê³„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- ì•¡ì…˜ê³¼ ê´€ê³„ ì—†ì´ ëª¨ë“  ì‚¬ìš©ì ì§‘ê³„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_venn_diagram</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ìœ ì‚¬ì ìœ¼ë¡œ NULLì„ í¬í•¨í•œ ë ˆì½”ë“œë¥¼ ì¶”ê°€í•´ì„œ CUBE êµ¬ë¬¸ê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- ì‚¬ìš©ìê°€ ì•¡ì…˜ì„ í–ˆìœ¼ë©´ 1, ì•ˆí–ˆìœ¼ë©´ 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;review&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;favorite&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">action_venn_diagram</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mod_has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- ê° ì»¬ëŸ¼ì— NULLì„ í¬í•¨í•˜ëŠ” ë ˆì½”ë“œë¥¼ ìœ ì‚¬ì ìœ¼ë¡œ ì¶”ê°€í•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- BigQueryì˜ ê²½ìš° CROSS JOIN unnest í•¨ìˆ˜ ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mod_has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mod_has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Hive, SparkSQLì˜ ê²½ìš° : LATERAL VIEWì™€ explode í•¨ìˆ˜ ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- LATERAL VIEW explode(array(has_purchase, NULL)) e1 AS mode_has_purchase
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- LATERAL VIEW explode(array(has_review, NULL)) e2 AS mod_has_review
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- LATERAL VIEW explode(array(has_favorite, NULL)) e3 AS mod_has_favorite
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">mod_has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_review</span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">action_venn_diagram</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">mod_has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_review</span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ë²¤ ë‹¤ì´ì–´ê·¸ë¨ì„ ë§Œë“¤ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- ì‚¬ìš©ìê°€ ì•¡ì…˜ì„ í–ˆìœ¼ë©´ 1, ì•ˆí–ˆìœ¼ë©´ 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;review&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">SIGN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;favorite&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">action_venn_diagram</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mod_has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_action_flag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mod_has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mod_has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="n">has_favorite</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">mod_has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_review</span><span class="p">,</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- í”Œë˜ê·¸ 0, 1ì„ ê°€ê³µí•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">CASE</span><span class="w"> </span><span class="n">mod_has_purchase</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;not purchase&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;any&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_purchase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="n">mod_has_review</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;review&#39;</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;not review&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;any&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;favorite&#39;</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;not favorite&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;any&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- ì „ì²´ ì‚¬ìš©ì ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¹„ìœ¨ êµ¬í•˜ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">NULLIF</span><span class="w"> </span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">mod_has_purchase</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">mod_has_review</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">mod_has_favorite</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">action_venn_diagram</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">has_purchase</span><span class="p">,</span><span class="w"> </span><span class="n">has_review</span><span class="p">,</span><span class="w"> </span><span class="n">has_favorite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>SNS ì ìš© ë°©ë²•<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>ê¸€ì„ ì‘ì„±í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ì‚¬ëŒì˜ ê¸€ë§Œ í™•ì¸í•˜ëŠ” ì‚¬ìš©ì</li>
<li>ê¸€ì„ ë§ì´ ì‘ì„±í•˜ëŠ” ì‚¬ìš©ì</li>
<li>ê¸€ì„ ê±°ì˜ ì‘ì„±í•˜ì§€ ì•Šì§€ë§Œ ëŒ“ê¸€ì€ ë§ì´ ì‘ì„±í•˜ëŠ” ì‚¬ìš©ì</li>
<li>ê¸€ê³¼ ëŒ“ê¸€ ëª¨ë‘ ì ê·¹ì ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì‚¬ìš©ì</li>
</ul>
</div>
        </div>
    </div>
<h3 id="116-decile-ë¶„ì„ì„-ì‚¬ìš©í•´-ì‚¬ìš©ìë¥¼-10ë‹¨ê³„-ê·¸ë£¹ìœ¼ë¡œ-ë‚˜ëˆ„ê¸°">11.6 Decile ë¶„ì„ì„ ì‚¬ìš©í•´ ì‚¬ìš©ìë¥¼ 10ë‹¨ê³„ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ê¸°</h3>
<ul>
<li>ì‚¬ìš©ì íŠ¹ì§•ì„ ë¶„ì„ ì‹œ ì„±ë³„ê³¼ ì—°ë ¹ ë“±ì˜ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ì´ëŸ¬í•œ ì†ì„±ì— ë”°ë¥¸ íŠ¹ì§•ì„ í™•ì¸ê°€ëŠ¥</li>
<li>ë°ëª¨ê·¸ë˜í”½í•œ ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ì‚¬ìš©ì ì•¡ì…˜ìœ¼ë¡œ ì†ì„±ì„ ì •ì˜í•´ ë³´ëŠ” ê²ƒë„ ì¢‹ìŒ</li>
<li>ë°ì´í„°ë¥¼ 10ë‹¨ê³„ë¡œ ë¶„í• í•´ì„œ ì¤‘ìš”ë„ë¥¼ íŒŒì•…í•˜ëŠ” <code>Decile</code> ë¶„ì„ ë°©ë²•ì„ ì‚¬ìš©</li>
</ul>
<h4 id="decile-ë¶„ì„-ê³¼ì •">Decile ë¶„ì„ ê³¼ì •</h4>
<p>ì‚¬ìš©ìì˜ êµ¬ë§¤ ê¸ˆì•¡ì— ë”°ë¼ ìˆœìœ„ë¥¼ êµ¬ë¶„í•˜ê³  ì¤‘ìš”ë„ë¥¼ íŒŒì•…í•˜ëŠ” ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ê¸°</p>
<ol>
<li>ì‚¬ìš©ìë¥¼ êµ¬ë§¤ ê¸ˆì•¡ì´ ë§ì€ ìˆœìœ¼ë¡œ ì •ë ¬</li>
<li>ì •ë ¬ëœ ì‚¬ìš©ì ìƒìœ„ë¶€í„° 10%ì”© Decile 10ê¹Œì§€ì˜ ê·¸ë£¹ì„ í• ë‹¹í•œë‹¤.</li>
<li>ê° ê·¸ë£¹ì˜ êµ¬ë§¤ ê¸ˆì•¡ í•©ê³„ë¥¼ ì§‘ê³„í•œë‹¤.</li>
<li>ì „ì²´ êµ¬ë§¤ ê¸ˆì•¡ì— ëŒ€í•´ ê° <code>Decile</code>ì˜ êµ¬ë§¤ ê¸ˆì•¡ ë¹„ìœ¨(êµ¬ì„±ë¹„)ë¥¼ ê³„ì‚°í•œë‹¤.</li>
<li>ìƒìœ„ì—ì„œ ëˆ„ì ìœ¼ë¡œ ì–´ëŠ ì •ë„ì˜ ë¹„ìœ¨ì„ ì°¨ì§€í•˜ëŠ”ì§€ êµ¬ì„±ë¹„ëˆ„ê³„ë¥¼ ì§‘ê³„í•œë‹¤.</li>
</ol>
<p><strong>êµ¬ë§¤ì•¡ì´ ë§ì€ ìˆœì„œë¡œ ì‚¬ìš©ì ê·¸ë£¹ì„ 10ë“±ë¶„ í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<ul>
<li>ì •ë ¬ëœ ì‚¬ìš©ì ìƒìœ„ì—ì„œ 10%ì”© Decile 1 ~ Decile 10 ê¹Œì§€ ê·¸ë£¹ì„ í• ë‹¹</li>
<li>ê°™ì€ ìˆ˜ë¡œ ë°ì´í„° ê·¸ë£¹ì„ ë§Œë“¤ ë•ŒëŠ” <code>NTILE</code> ìœˆë„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">user_purchase_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">user_with_decile</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">ntile</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_with_decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>10ë“±ë¶„í•œ Decileë“¤ì„ ì§‘ê³„í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">user_purchase_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">user_with_decile</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">ntile</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">decile_with_purchase_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">decile</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cumulative_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_with_decile</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">decile_with_purchase_amount</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>êµ¬ë§¤ì•¡ì´ ë§ì€ Decile ìˆœì„œë¡œ êµ¬ì„±ë¹„ì™€ êµ¬ì„±ë¹„ëˆ„ê³„ë¥¼ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">user_purchase_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">user_with_decile</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">ntile</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">purchase_amount</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_purchase_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">decile_with_purchase_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">decile</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cumulative_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">purchase_amount</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_with_decile</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">decile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">avg_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cumulative_amount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cumulative_ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">decile_with_purchase_amount</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>Decile ë¶„ì„ì„ ì‹œí–‰í•˜ë©´<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><code>Decile</code>ì˜ íŠ¹ì§•ì„ ë‹¤ë¥¸ ë¶„ì„ ë°©ë²•ìœ¼ë¡œ ì„¸ë¶„í™”í•˜ì—¬ ì¡°ì‚¬í•˜ë©´ ì‚¬ìš©ìì˜ ì†ì„±ì„ ìì„¸í•˜ê²Œ íŒŒì•… ê°€ëŠ¥</li>
<li>ì˜ˆì‹œë¡œ <code>Decile 7 ~ 10</code> ì€ ì •ì°©ë˜ì§€ ì•Šì€ ê³ ê°ì„ ë‚˜íƒ€ë‚´ë©´
<ul>
<li>ë©”ì¼ ë§¤ê±°ì§„ ë“±ìœ¼ë¡œ ë¦¬í…ì…˜ì„ ë†’ì´ëŠ” ë“±ì˜ ëŒ€ì±…ì„ ê°•êµ¬í•´ë³¼ ìˆ˜ ìˆìŒ</li>
<li>ì´ë¯¸ ë§¤ê±°ì§„ì„ ë³´ë‚´ëŠ” ìƒí™©ì´ë©´ ë©”ì¼ ë§¤ê±°ì§„ì„ ë³´ë‚¼ ë•Œ ì¶”ê°€ì ì¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ í•´ë‹¹ decileì— í•´ë‹¹í•˜ëŠ” ì‚¬ëŒë“¤ì˜ ì†ì„±ê³¼ ê´€ë ¨ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  í™œìš©</li>
</ul>
</li>
</ul>
</div>
        </div>
    </div>
<h3 id="117-rfm-ë¶„ì„ìœ¼ë¡œ-ì‚¬ìš©ìë¥¼-ì„¸-ê°€ì§€--ê·¸ë£¹ìœ¼ë¡œ-ë‚˜ëˆ„ê¸°">11.7 RFM ë¶„ì„ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ì„¸ ê°€ì§€  ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ê¸°</h3>
<ul>
<li><strong>Decile ë¶„ì„ì˜ ë¬¸ì œì </strong>
<ul>
<li>ê²€ìƒ‰ ê¸°ê°„ì— ë”°ë¼ ë¬¸ì œê°€ ë°œìƒ</li>
<li>ê²€ìƒ‰ê¸°ê°„ì´ ë„ˆë¬´ ê¸´ ê²½ìš° - ê³¼ê±°ì˜ ìš°ìˆ˜ê³ ê°ì´ì–´ë„ í˜„ì¬ëŠ” ë‹¤ë¥¸ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” íœ´ë©´ ê³ ê°ì´ í¬í•¨ë  ê°€ëŠ¥ì„± ìˆìŒ</li>
<li>ê²€ìƒ‰ê¸°ê°„ì´ ë„ˆë¬´ ì§§ì€ ê²½ìš° - ì •ê¸°ì ìœ¼ë¡œ êµ¬ë§¤í•˜ëŠ” ì•ˆì • ê³ ê°ì´ í¬í•¨ë˜ì§€ ì•Šê³  í•´ë‹¹ ê¸°ê°„ë™ì•ˆ ì¼ì‹œì ìœ¼ë¡œ ë§ì´ êµ¬ë§¤í•œ ì‚¬ìš©ìê°€ ìš°ìˆ˜ ê³ ê° ì·¨ê¸‰</li>
</ul>
</li>
</ul>
<h4 id="rfm-ë¶„ì„ì˜-ì„¸ê°€ì§€-ì§€í‘œ-ì§‘ê³„í•˜ê¸°">RFM ë¶„ì„ì˜ ì„¸ê°€ì§€ ì§€í‘œ ì§‘ê³„í•˜ê¸°</h4>
<ul>
<li>RFM ë¶„ì„ì˜ ì„¸ê°€ì§€ ì§€í‘œ
<ul>
<li><strong>Recency(ìµœê·¼ êµ¬ë§¤ì¼)</strong> : ìµœê·¼ ë¬´ì–¸ê°€ë¥¼ êµ¬ë§¤í•œ ì‚¬ìš©ìë¥¼ ìš°ëŸ‰ ê³ ê°ìœ¼ë¡œ ì·¨ê¸‰</li>
<li><strong>Frequency(êµ¬ë§¤ íšŸìˆ˜)</strong> : ì‚¬ìš©ìê°€ êµ¬ë§¤í•œ íšŸìˆ˜ë¥¼ ì„¸ê³  ë§ì„ ìˆ˜ë¡ ìš°ëŸ‰ ê³ ê°ìœ¼ë¡œ ì·¨ê¸‰</li>
<li><strong>Mondtary(êµ¬ë§¤ ê¸ˆì•¡ í•©ê³„)</strong> : ì‚¬ìš©ìì˜ êµ¬ë§¤ ê¸ˆì•¡ í•©ê³„ë¥¼ ì§‘ê³„í•˜ê³  ê¸ˆì•¡ì´ ë†’ì„ ìˆ˜ë¡ ìš°ëŸ‰ ê³ ê°ìœ¼ë¡œ ì·¨ê¸‰</li>
</ul>
</li>
<li>Recency, Frequency, Monetary 3 ê°œì˜ ì•ê¸€ìë¥¼ ë”°ì„œ RFM ë¶„ì„ì´ë¼ê³  í•¨</li>
<li>Decile ë¶„ì„ì—ì„œëŠ” í•œ ë²ˆ êµ¬ë§¤ë¡œ ë¹„ì‹¼ ë¬¼ê±´ì„ êµ¬ë§¤í•œ ì‚¬ìš©ìì™€ ì •ê¸°ì ìœ¼ë¡œ ì €ë ´í•œ ë¬¼ê±´ì„ ì—¬ëŸ¬ë²ˆ êµ¬ë§¤í•œ ì‚¬ìš©ìê°€ ê°™ì€ ê·¸ë£¹ìœ¼ë¡œ íŒë³„</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">purchase_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- PostgreSQL, Hive, BigQuery, SparkSQL ì˜ ê²½ìš° substring ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">-- , substring(stamp, 1, 10) AS dt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- PostgreSQL, Hive, BigQuery, SparkSQL ì˜ ê²½ìš° substr ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">user_rfm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- BigQuery : date_diff í•¨ìˆ˜ ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">(</span><span class="k">timestamp</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">))),</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">-- PostgreSQL, Redshift : ë‚ ì§œ í˜•ì‹ë¼ë¦¬ ë¹¼ê¸° ê°€ëŠ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">--, CURRENT_DATE - MAX(dt::date) AS recency
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">-- Hive, SparkSQL : datediff í•¨ìˆ˜ ì‚¬ìš©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">--, datediff(CURRENT_DATE(), to_date(MAX(dt))) AS recency
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">purchase_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rfm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="rfm-ë­í¬ì •ì˜í•˜ê¸°">RFM ë­í¬ì •ì˜í•˜ê¸°</h4>
<ul>
<li>RFM ë¶„ì„ì—ì„œëŠ” 3ê°œì˜ ì§€í‘œë¥¼ ê°ê° 5ê°œì˜ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒì´ ì¼ë°˜ì 
<ul>
<li><code>125 = 5 * 5 * 5</code> ê°œì˜ ê·¸ë£¹ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ë‚˜ëˆ„ì–´ íŒŒì•…</li>
</ul>
</li>
</ul>
<p><strong>RFM ë­í¬ ì •ì˜ í…Œì´ë¸”</strong></p>
<table>
<thead>
<tr>
<th>ë­í¬</th>
<th>R:ìµœê·¼ êµ¬ë§¤ì¼</th>
<th>F:ëˆ„ê³„ êµ¬ë§¤ íšŸìˆ˜</th>
<th>M:ëˆ„ê°œ êµ¬ë§¤ ê¸ˆì•¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>14ì¼ ì´ë‚´</td>
<td>20íšŒ ì´ìƒ</td>
<td>300ë§Œì› ì´ìƒ</td>
</tr>
<tr>
<td>4</td>
<td>28ì¼ ì´ë‚´</td>
<td>10íšŒ ì´ìƒ</td>
<td>100ë§Œì› ì´ìƒ</td>
</tr>
<tr>
<td>3</td>
<td>60ì¼ ì´ë‚´</td>
<td>5íšŒ ì´ìƒ</td>
<td>30ë§Œì› ì´ìƒ</td>
</tr>
<tr>
<td>2</td>
<td>90ì¼ ì´ë‚´</td>
<td>2íšŒ ì´ìƒ</td>
<td>5ë§Œì› ì´ìƒ</td>
</tr>
<tr>
<td>1</td>
<td>91ì¼ ì´ë‚´</td>
<td>1íšŒ</td>
<td>5ë§Œì› ë¯¸ë§Œ</td>
</tr>
</tbody>
</table>
<p><strong>ì‚¬ìš©ìë“¤ì˜ RFM ë­í¬ë¥¼ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">purchase_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">user_rfm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">(</span><span class="k">timestamp</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">))),</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">purchase_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">300000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">30000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rfm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ê° ê·¸ë£¹ì— ì‚¬ëŒ ìˆ˜ë¥¼ í™•ì¸í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">purchase_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">user_rfm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">(</span><span class="k">timestamp</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">))),</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">purchase_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">300000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">30000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rfm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mst_rfm_index</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- 1 ~ 5 ê¹Œì§€ ìˆ«ìë¥¼ ê°€ì§€ëŠ” í…Œì´ë¸” ë§Œë“¤ê¸°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- PostgreSQLì˜ ê²½ìš° generate_series ë“±ìœ¼ë¡œë„ ëŒ€ì²´ ê°€ëŠ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rfm_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rfm_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rfm_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rfm_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rfm_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">rfm_flag</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">m</span><span class="p">.</span><span class="n">rfm_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">rfm_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">r</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r_flag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">mst_rfm_index</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">rfm_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">r_flag</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">r_flag</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">r_flag</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">rfm_flag</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rfm_index</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rfm_index</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ê·¹ë‹¨ì ìœ¼ë¡œ ì ì€ ì‚¬ìš©ì ìˆ˜ì˜ ê·¸ë£¹ì´ ë°œìƒí•œë‹¤ë©´, RFM ë­í¬ ì •ì˜ë¥¼ ìˆ˜ì •í•´ì•¼ í•¨</li>
<li>ê·¸ë£¹ì´ ê·¸ë¶„ë˜ë©´ ê°ê° FRM ë­í¬ë³„ë¡œ ì–´ë– í•œ ëŒ€ì²´</li>
</ul>
<h4 id="ì‚¬ìš©ìë¥¼-1ì°¨ì›ìœ¼ë¡œ-êµ¬ë¶„í•˜ê¸°">ì‚¬ìš©ìë¥¼ 1ì°¨ì›ìœ¼ë¡œ êµ¬ë¶„í•˜ê¸°</h4>
<ul>
<li><strong>RFM ë¶„ì„ì„ 3ì°¨ì›ìœ¼ë¡œ í‘œí˜„í•˜ë©´ 125ê°œì˜ ê·¸ë£¹ì´ ë°œìƒí•˜ë¯€ë¡œ ê´€ë¦¬ê°€ ë§¤ìš° ì–´ë ¤ì›€</strong></li>
<li><code>R+F+M</code> ê° ë­í¬ í•©ê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 13ê°œ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê´€ë¦¬</li>
</ul>
<p><strong>í†µí•© ë­í¬ë³„ ì‚¬ìš©ì ìˆ˜</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>í†µí•© ë­í¬</strong></th>
<th style="text-align:center"><strong>R</strong></th>
<th style="text-align:center"><strong>F</strong></th>
<th style="text-align:center"><strong>M</strong></th>
<th style="text-align:center"><strong>ì‚¬ìš©ì ìˆ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">15</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">9</td>
</tr>
<tr>
<td style="text-align:center">14</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
<td style="text-align:center">13</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
<td style="text-align:center">5</td>
<td style="text-align:center">15</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">4</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">15</td>
</tr>
<tr>
<td style="text-align:center">13</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">3</td>
<td style="text-align:center">16</td>
</tr>
<tr>
<td style="text-align:center">Â </td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">â€¦</td>
<td style="text-align:center">â€¦</td>
<td style="text-align:center">â€¦</td>
<td style="text-align:center">â€¦</td>
<td style="text-align:center">â€¦</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">842</td>
</tr>
</tbody>
</table>
<p><strong>í†µí•© ë­í¬ë¥¼ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">purchase_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">user_rfm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">(</span><span class="k">timestamp</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">))),</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">purchase_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">300000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">30000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rfm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_rank</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ì¢…í•© ë­í¬ë³„ë¡œ ì‚¬ìš©ì ìˆ˜ë¥¼ ì§‘ê³„í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">purchase_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">user_rfm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">(</span><span class="k">timestamp</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">))),</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">purchase_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">300000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">30000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rfm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- PostgreSQL, Redshift, BigQuery : SELECT êµ¬ë¬¸ì—ì„œ ì •ì˜í•œ ë³„ì¹­ì„ GROUP BY ë¬¸ì— ì§€ì • ê°€ëŠ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- PostgreSQL, Hive, Redshift, SparkSQL : SELECT êµ¬ë¬¸ì—ì„œ ë³„ì¹­ì„ ì§€ì •í•˜ê¸° ì „ ì‹ì„ GROUP BY ë¬¸ì— ì§€ì • ê°€ëŠ¥
</span></span></span><span class="line"><span class="cl"><span class="c1">-- GROUP BY r + f + m
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_rank</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2ì°¨ì›ìœ¼ë¡œ-ì‚¬ìš©ì-ì¸ì‹í•˜ê¸°">2ì°¨ì›ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì‹í•˜ê¸°</h4>
<ul>
<li>RFMì„ ì§€í‘œ 2ê°œë¥¼ ì‚¬ìš©í•´ì„œ ì‚¬ìš©ì ì¸µì„ ì •ì˜í•œë‹¤.</li>
<li>2ì°¨ì›ìœ¼ë¡œ ì‚¬ìš©ì ì¸µì„ êµ¬ì„±í•˜ë©´
<ul>
<li>ê° ì‚¬ìš©ì ì¸µì— ì–´ë–¤ ë§ˆì¼€íŒ… ëŒ€ì±…ì„ ì‹¤ì‹œ í• ì§€</li>
<li>ìƒìœ„ ì‚¬ìš©ì ì¸µìœ¼ë¡œ ì–´ë–»ê²Œ êµ¬ì„±í• ì§€ ìƒê° í•´ ë³¼ ìˆ˜ ìˆë‹¤.</li>
</ul>
</li>
</ul>
<p><strong>Rê³¼ Fë¥¼ ì‚¬ìš©í•´ 2ì°¨ì›ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì‹</strong></p>
<figure><img src="/posts/images/sql-recipe/rfm-2.png#center">
</figure>

<p><strong>Rê³¼ Fë¥¼ ì‚¬ìš©í•´ 2ì°¨ì› ì‚¬ìš©ì ì¸µì˜ ì‚¬ìš©ì ìˆ˜ë¥¼ ì§‘ê³„í•˜ëŠ” ì¿¼ë¦¬</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">purchase_log</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">stamp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sample_data</span><span class="p">.</span><span class="n">action_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purchase&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">user_rfm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">(</span><span class="k">timestamp</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">dt</span><span class="p">))),</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">purchase_log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recent_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">recency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">monetary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="n">recency</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">300000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">30000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">WHEN</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">monetary</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rfm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- BigQuery : Concat í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ string ìœ¼ë¡œ ë³€í™˜í•´ì•¼ í•¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;r_&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">r_rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">--, CONCAT(&#39;r_&#39;, r AS string)  AS r_rank
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f_5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f_4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f_3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f_2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f_1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">user_rmf_rank</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">r_rank</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ì–´ë–¤ ëŒ€ì±…ì„ ì‹¤ì‹œí• ì§€ ìƒê°í•´ë³´ê¸°</strong>
<figure><img src="/posts/images/sql-recipe/rfm-3.png#center">
</figure>
</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-06-24&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/23c45c8708c6ff29696def98046311196cf3bb44" target="_blank" title="commit by riley(41636282&#43;riley817@users.noreply.github.com) 23c45c8708c6ff29696def98046311196cf3bb44: Update main.yml">
                                    <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>23c45c8</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/data/">Data</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/bigquery-datagrip/" class="prev" rel="prev" title="êµ¬ê¸€ ë¹…ì¿¼ë¦¬(BigQuery) ì‹œì‘í•˜ê¸° ë° DataGrip ì—°ë™"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>êµ¬ê¸€ ë¹…ì¿¼ë¦¬(BigQuery) ì‹œì‘í•˜ê¸° ë° DataGrip ì—°ë™</a>
            <a href="/sql-recipe-5-2/" class="next" rel="next" title="ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ - 5ì¥ ì‚¬ìš©ìë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•œ ë°ì´í„° ì¶”ì¶œ">ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ SQL ë ˆì‹œí”¼ - 5ì¥ ì‚¬ìš©ìë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•œ ë°ì´í„° ì¶”ì¶œ<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><script src="https://utteranc.es/client.js"
            repo="riley817/blog-comment"
            issue-term="pathname"
            label="âœ¨ğŸ’¬âœ¨"
            theme="github-light"
            crossorigin="anonymous"
            async>
        </script>
    </div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.127.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/riley817" target="_blank">Riley</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"algoliaAppID":"","algoliaIndex":"","algoliaSearchKey":"","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
