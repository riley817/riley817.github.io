# [Go 언어를 활용한 네트워크 프로그래밍] 3. 신뢰성 있는 TCP 데이터 스트림


> Go 언어를 활용한 네트워크 프로그래밍 책 정리

## TCP를 신뢰성 있게 만드는 것
- **패킷손실`packet loss`** : 무선 네트워크 간섭이나 네트워크 정체 등의 이유로 데이터가 전송에 실패하여 목적지까지 도달하지 못한 경우 발생 
- **네트워크 정체`network congestion`** : 네트워크의 연결상 처리할 수 있는 양 이상의 데이터를 전송하려 할 때 발생 
- TCP는 흐름제어 `flow control` 절차를 통해 데이터의 전송 속도를 조정하여 네트워크의 상태가 변경되더라도 손실된 패킷을 최소로 유지하면서 데이터를 빠르게 전송할 수 있다.
- TCP는 수신한 패킷을 추적하고, 승인되지 않은 패킷은 필요에 따라 재전송 한다.
- **흐름제어, 재전송과 함께 이러한 속성들은 TCP가 패킷 손실의 문제를 해결하고 데이터의 전송의 신뢰도를 높여준다.**

## TCP 세션 사용
- TCP 세션을 사용하면 어떠한 크기의 데이터 스트림이라도 전송할 수 이으며 데이터가 정상적으로 수신되었다는 것을 확인할 수 있다.
- TCP 세션은 두 노드간 대화라고 생각할 수 있다.

### TCP 핸드셰이크를 통한 세션 수립
- TCP 연결은 두 노드 사이에 3방향 핸드셰이크 `three-way handshake`라 부르는 과정을 통해 진행된다.
- TCP 세션이 수립되려면 서버는 반드시 연결 요청을 수신 대기하고 있어야 한다.

{{<figure src="/posts/images/go/three-way-handshake.jpg#center" width="500px">}}

1. 클라이언트는 **SYN`synchronize`** 플래그가 설정된 패킷을 서버로 전송한다. 이 SYN 패킷은 서버에게 클라이언트의 정보와 이후 통신에서 사용할 슬라이딩 윈도 설정값을 알려준다.
2. 서버는 **ACK`Acknowledgement`** 플래그와 SYN 플래그가 설정된 패킷을 클라이언트로 전송한다. ACK 플래그는 클라이언트가 보낸 SYN 패킷을 정상적으로 수신하였다는 의미이다. 서버의 SYN 패킷은 클라이언트가 보낸 SYN 패킷의 설정 값에서 어떤 설정 값을 통신 중에 사용할지 클라이언트에게 통보한다.
3. 클라이언트는 서버의 SYN 패킷을 승인한다는 ACK 패킷을 보내며 3방향 핸드셰이크가 완료된다.
4. 3방향 핸드셰이크가 완료되면 TCP 세션이 수립되며 이후 두 노드는 데이터를 주고받을 수 있다.

### 시퀀스 번호를 이용한 패킷 수신 확인



